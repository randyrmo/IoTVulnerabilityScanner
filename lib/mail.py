import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText

def CreateSMTP(email = "iotvulnerability@gmail.com", password = "wrongpassword"):
	try:
		s = smtplib.SMTP(host='smtp.gmail.com', port=587)
		s.starttls()
		s.login(email, password)
		return s
	except:
		print("\nTry enabling less-secure-apps in your gmail settings")
		return None

def createMessage(body, rec, messageFor = "admin"):
	dic = {}
	dic["owner"] = "Scan Results for Device Owner"
	dic["admin"] = "Scan Results for Admin"

	msg = MIMEMultipart('alternative')
	msg['From']='iotvulnerability@gmail.com'
	msg['To']= rec
	msg['Subject'] = dic[messageFor]

	data = MIMEText(body, 'html')
	msg.attach(data)
	return msg

def sendMessage(receivers, content):
	s = CreateSMTP()
	if s is None:
		print("Mail cannot be sent as login did not succeed")
		return
	for rec in receivers:
		msg = createMessage(content, rec)
		try:
			s.send_message(msg)
			print("Mail sent successfully")
		except:
			print("Mail could not be sent")
		del msg
	s.quit()